<!-- pages/menu/menu.wxml -->

<view class="menu-container">
  <view class="search-container">
    <input class="search-input" placeholder="老婆今天想吃啥呢" value="{{searchQuery}}" bindinput="onSearchInput" bindconfirm="onSearchConfirm" confirm-type="search" />
    <button wx:if="{{searchQuery && searchQuery.length>0}}" class="clear-btn" bindtap="clearSearch">✕</button>
  </view>
  <!-- 顶部四个分类（完美居中） -->
  <view class="fixed-tabs">
    <view class="tabs-container">
      <view class="tab-item {{currentCat === item ? 'active' : ''}}" wx:for="{{categories}}" wx:key="*this" data-cat="{{item}}" bindtap="switchCategory">
        {{item}}
      </view>
    </view>
  </view>

  <!-- 菜品列表 -->
  <view class="dish-list">
    <block wx:if="{{groupedMenu[currentCat] && groupedMenu[currentCat].length > 0}}">
      <view wx:for="{{groupedMenu[currentCat]}}" wx:for-item="item" wx:key="id" class="dish-card">

        <view class="dish-content">
          <view class="dish-name">{{item.name}}</view>
          <!-- 配料 -->
          <view class="section">
            <view class="section-title" bindtap="toggleSection" data-id="{{item.id}}" data-type="ingredients">
              配料 <text class="arrow {{item.showIngredients ? 'up' : 'down'}}" style="pointer-events:none;">></text>
            </view>
            <!-- ↓ 这一行是您刚才漏掉的关键内容显示区域 -->
            <view class="section-content" wx:if="{{item.showIngredients}}">
              {{item.ingredients || '老板秘方，不外传~'}}
            </view>
          </view>

          <!-- 制作方法 -->
          <!-- <view class="section">
            <view class="section-title" bindtap="toggleSection" data-id="{{item.id}}" data-type="method">
              制作方法 <text class="arrow {{item.showMethod ? 'up' : 'down'}}" style="pointer-events:none;">></text>
            </view> -->
          <!-- ↓ 这一行也必须加回来 -->
          <!-- <view class="section-content method-text" wx:if="{{item.showMethod}}">
              {{item.cooking_method || '大火爆炒，香到你哭！'}}
            </view>
          </view> -->
          <!-- 制作方法（按句号换行展示） -->
          <view class="section">
            <view class="section-title" bindtap="toggleSection" data-id="{{item.id}}" data-type="method">
              制作方法 <text class="arrow {{item.showMethod ? 'up' : 'down'}}" style="pointer-events:none;">></text>
            </view>

            <view class="section-content method-text" wx:if="{{item.showMethod}}">
              <block wx:if="{{item.methodLines && item.methodLines.length > 0}}">
                <text wx:for="{{item.methodLines}}" wx:key="*this" class="method-line">
                  {{index + 1}}. {{item}}\n
                </text>
              </block>
              <text wx:else>大火爆炒，香到你哭！</text>
            </view>
          </view>


          <button class="add-btn" bindtap="addToCart" data-id="{{item.id}}">+ 加入购物车</button>
        </view>
      </view>
    </block>

    <view wx:else class="empty-tip">该分类暂无菜品</view>
  </view>
</view>

<!-- 购物车小红点 -->
<view class="cart-badge" wx:if="{{cartCount > 0}}">{{cartCount}}</view>